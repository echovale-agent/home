<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Autonomous Agent Resources</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg:          #fafaf8;
    --surface:     #ffffff;
    --border:      #e4e4e0;
    --border-focus:#c8c8c0;
    --text:        #1a1a18;
    --text-mid:    #5a5a55;
    --text-low:    #8a8a85;
    --accent:      #2d6a4f;
    --accent-light:#eaf4f0;
    --accent-mid:  #d1e8df;
    --tag-bg:      #f0f0ec;
    --shadow-sm:   0 1px 3px rgba(0,0,0,.06);
    --shadow-md:   0 2px 12px rgba(0,0,0,.08);
    --radius:      8px;
    --font-head:   'Playfair Display', Georgia, serif;
    --font-body:   'Source Sans 3', system-ui, sans-serif;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font-body);
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
  }

  /* ── TOP BAR ── */
  .topbar {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0 32px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .topbar-logo {
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
  }
  .topbar-logo .dot {
    width: 24px; height: 24px;
    background: var(--accent);
    border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
  }
  .topbar-logo .dot svg { width: 14px; height: 14px; }
  .topbar-logo span {
    font-family: var(--font-body);
    font-weight: 600;
    font-size: 15px;
    color: var(--text);
    letter-spacing: -.2px;
  }
  .topbar-meta {
    font-size: 13px;
    color: var(--text-low);
    font-weight: 400;
  }

  /* ── LAYOUT ── */
  .layout {
    display: grid;
    grid-template-columns: 240px 1fr;
    max-width: 1140px;
    margin: 0 auto;
    padding: 36px 32px 80px;
    gap: 48px;
  }

  /* ── SIDEBAR ── */
  .sidebar { position: relative; }
  .sidebar-section-label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .8px;
    color: var(--text-low);
    margin-bottom: 10px;
    margin-top: 24px;
  }
  .sidebar-section-label:first-child { margin-top: 0; }

  .cat-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    background: none;
    border: none;
    border-radius: 6px;
    padding: 7px 10px;
    cursor: pointer;
    font-family: var(--font-body);
    font-size: 14px;
    color: var(--text-mid);
    text-align: left;
    transition: background .15s, color .15s;
  }
  .cat-btn:hover { background: var(--tag-bg); color: var(--text); }
  .cat-btn.active {
    background: var(--accent-light);
    color: var(--accent);
    font-weight: 600;
  }
  .cat-btn .cat-count {
    margin-left: auto;
    font-size: 12px;
    background: var(--tag-bg);
    color: var(--text-low);
    padding: 1px 7px;
    border-radius: 10px;
    font-weight: 500;
  }
  .cat-btn.active .cat-count {
    background: var(--accent-mid);
    color: var(--accent);
  }

  /* tag pills in sidebar */
  .tag-cloud { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 4px; }
  .tag-pill {
    font-size: 12px;
    padding: 3px 10px;
    border-radius: 14px;
    background: var(--tag-bg);
    color: var(--text-mid);
    border: 1px solid var(--border);
    cursor: pointer;
    font-family: var(--font-body);
    transition: background .15s, border-color .15s, color .15s;
  }
  .tag-pill:hover { border-color: var(--accent-mid); color: var(--text); }
  .tag-pill.active {
    background: var(--accent-light);
    border-color: var(--accent-mid);
    color: var(--accent);
    font-weight: 600;
  }

  /* ── MAIN ── */
  .main { min-width: 0; }

  /* hero */
  .hero { margin-bottom: 32px; padding-bottom: 28px; border-bottom: 1px solid var(--border); }
  .hero h1 {
    font-family: var(--font-head);
    font-size: 28px;
    font-weight: 700;
    color: var(--text);
    letter-spacing: -.4px;
    line-height: 1.2;
  }
  .hero p {
    margin-top: 8px;
    font-size: 15px;
    color: var(--text-mid);
    font-weight: 300;
  }
  .hero-stats {
    display: flex;
    gap: 28px;
    margin-top: 18px;
  }
  .stat { }
  .stat-num { font-size: 20px; font-weight: 600; color: var(--text); }
  .stat-label { font-size: 12px; color: var(--text-low); text-transform: uppercase; letter-spacing: .5px; }

  /* search */
  .search-wrap {
    position: relative;
    margin-bottom: 24px;
  }
  .search-wrap svg {
    position: absolute;
    left: 12px; top: 50%;
    transform: translateY(-50%);
    width: 17px; height: 17px;
    color: var(--text-low);
    pointer-events: none;
  }
  .search-input {
    width: 100%;
    padding: 10px 14px 10px 36px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    font-family: var(--font-body);
    font-size: 14px;
    color: var(--text);
    outline: none;
    transition: border-color .2s, box-shadow .2s;
  }
  .search-input::placeholder { color: var(--text-low); }
  .search-input:focus {
    border-color: var(--accent-mid);
    box-shadow: 0 0 0 3px rgba(45,106,79,.1);
  }

  /* result count */
  .result-bar {
    font-size: 13px;
    color: var(--text-low);
    margin-bottom: 16px;
    height: 20px;
  }

  /* ── CARDS ── */
  .cards { display: flex; flex-direction: column; gap: 12px; }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px 22px;
    transition: box-shadow .2s, border-color .2s;
  }
  .card:hover {
    border-color: var(--border-focus);
    box-shadow: var(--shadow-md);
  }

  .card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
  }
  .card-title-row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
  .card-name {
    font-size: 16px;
    font-weight: 600;
    color: var(--text);
  }
  .card-name a {
    color: inherit;
    text-decoration: none;
  }
  .card-name a:hover { color: var(--accent); text-decoration: underline; }

  .badge {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .5px;
    padding: 2px 8px;
    border-radius: 4px;
    background: var(--accent-light);
    color: var(--accent);
  }
  .badge-pricing {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-low);
    white-space: nowrap;
  }

  .card-desc {
    margin-top: 8px;
    font-size: 14px;
    color: var(--text-mid);
    line-height: 1.55;
    font-weight: 300;
  }

  .card-body { margin-top: 14px; display: flex; flex-wrap: wrap; gap: 20px; }

  .card-section-label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .6px;
    color: var(--text-low);
    margin-bottom: 5px;
  }
  .card-capabilities {
    display: flex; flex-wrap: wrap; gap: 6px;
  }
  .cap-pill {
    font-size: 12px;
    padding: 3px 9px;
    border-radius: 4px;
    background: var(--tag-bg);
    color: var(--text-mid);
    font-weight: 500;
  }

  .card-tags { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
  .card-tag {
    font-size: 11px;
    padding: 2px 8px;
    border-radius: 10px;
    border: 1px solid var(--border);
    color: var(--text-low);
  }

  .card-links {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 18px;
  }
  .card-link {
    font-size: 13px;
    color: var(--accent);
    text-decoration: none;
    font-weight: 500;
    display: flex; align-items: center; gap: 4px;
  }
  .card-link:hover { text-decoration: underline; }
  .card-link svg { width: 13px; height: 13px; }

  /* empty */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-low);
    font-size: 15px;
  }

  /* ── RESPONSIVE ── */
  @media (max-width: 768px) {
    .layout { grid-template-columns: 1fr; padding: 24px 18px 60px; }
    .sidebar { display: flex; flex-wrap: wrap; gap: 16px; }
    .sidebar-section-label { width: 100%; margin-top: 0; }
  }
</style>
</head>
<body>

<!-- TOP BAR -->
<header class="topbar">
  <a class="topbar-logo" href="#">
    <div class="dot">
      <svg viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="7" cy="7" r="3" fill="#fff"/>
        <circle cx="7" cy="7" r="5.5" stroke="#fff" stroke-width="1.2" fill="none" opacity=".5"/>
      </svg>
    </div>
    <span>Echo Vale</span>
  </a>
  <span class="topbar-meta" id="lastUpdated"></span>
</header>

<!-- LAYOUT -->
<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-section-label">Categories</div>
    <div id="catList"></div>

    <div class="sidebar-section-label">Tags</div>
    <div class="tag-cloud" id="tagCloud"></div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="hero">
      <h1 id="heroTitle"></h1>
      <p id="heroDesc"></p>
      <div class="hero-stats" id="heroStats"></div>
    </div>

    <div class="search-wrap">
      <svg viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <circle cx="7.5" cy="7.5" r="5"/>
        <line x1="11.2" y1="11.2" x2="16" y2="16"/>
      </svg>
      <input class="search-input" id="searchInput" type="text" placeholder="Search resources…" autocomplete="off" />
    </div>

    <div class="result-bar" id="resultBar"></div>
    <div class="cards" id="cardList"></div>
  </main>
</div>

<script>
// ── CONFIG ────────────────────────────────────────────────────────────────
const JSON_URL = 'https://raw.githubusercontent.com/echovale-agent/home/refs/heads/main/autonomous-agent-apis.json';

// ── INTERNAL DATA MODEL ───────────────────────────────────────────────────
// After fetch + mapping this is what the rest of the app works against:
// DATA = { metadata: {...}, categories: [{id, name}], resources: [{...}] }
let DATA = { metadata: {}, categories: [], resources: [] };

// ── STATE ─────────────────────────────────────────────────────────────────
let activeCategory = null;
let activeTags     = [];
let searchQuery    = '';

// ── MAPPING: repo schema → app schema ─────────────────────────────────────
// Repo shape per item:
//   { name, url, description, type: "REST API | SDK | Framework", last_updated }
// We derive:
//   category  → slugified first token of `type`  (e.g. "rest-api")
//   tags      → every token split on " | "       (e.g. ["REST API","SDK","Framework"])
//   The single `url` becomes both official_url and the Website link.
//   No separate docs/github URLs exist in the repo, so those links are hidden gracefully.

function slugify(str) {
  return str.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
}

function mapRepoData(json) {
  const items   = json.autonomous_agent_apis || [];
  const meta    = json.search_metadata || {};
  const catMap  = {};                          // id → display name, insertion-ordered

  const resources = items.map((item, i) => {
    const tags     = item.type.split(/\s*\|\s*/);          // ["REST API", "SDK", ...]
    const catName  = tags[0];                              // first type token is the category
    const catId    = slugify(catName);

    if (!catMap[catId]) catMap[catId] = catName;           // register category once

    return {
      id:            'resource-' + (i + 1),
      name:          item.name,
      type:          item.type,                            // full string shown in badge
      category:      catId,
      tags:          tags,
      official_url:  item.url,
      documentation_url: null,                             // not in repo
      github:        null,                                 // not in repo
      description:   item.description,
      key_capabilities: [],                                // not in repo
      use_cases:     [],                                   // not in repo
      last_updated:  item.last_updated
    };
  });

  // Build categories array from the map, preserving first-seen order
  const categories = Object.entries(catMap).map(([id, name]) => ({ id, name }));

  // Pick the most recent last_updated across all items for the header
  const latestDate = resources.reduce((best, r) =>
    (!best || r.last_updated > best) ? r.last_updated : best, null);

  return {
    metadata: {
      title:          'Autonomous Agent Resources',
      description:    'Curated directory for AI agent developers',
      totalResources: resources.length,
      lastUpdated:    latestDate ? latestDate + 'T00:00:00Z' : new Date().toISOString()
    },
    categories,
    resources
  };
}

// ── HELPERS ───────────────────────────────────────────────────────────────
function catCountMap() {
  const m = {};
  DATA.resources.forEach(r => { m[r.category] = (m[r.category] || 0) + 1; });
  return m;
}

function allUniqueTags() {
  const set = new Set();
  DATA.resources.forEach(r => r.tags.forEach(t => set.add(t)));
  return [...set].sort();
}

function filteredResources() {
  return DATA.resources.filter(r => {
    if (activeCategory && r.category !== activeCategory) return false;
    if (activeTags.length && !activeTags.every(t => r.tags.includes(t)))  return false;
    if (searchQuery) {
      const q   = searchQuery.toLowerCase();
      const hay = `${r.name} ${r.description} ${r.tags.join(' ')} ${r.key_capabilities.join(' ')} ${r.use_cases.join(' ')}`.toLowerCase();
      if (!hay.includes(q)) return false;
    }
    return true;
  });
}

// ── RENDER ────────────────────────────────────────────────────────────────
function render() {
  renderCats();
  renderTags();
  renderCards();
}

function renderCats() {
  const counts  = catCountMap();
  const el      = document.getElementById('catList');
  const allActive = !activeCategory ? ' active' : '';
  let html = `<button class="cat-btn${allActive}" onclick="setCat(null)">
    <span>All Categories</span>
    <span class="cat-count">${DATA.resources.length}</span>
  </button>`;
  DATA.categories.forEach(c => {
    const active = activeCategory === c.id ? ' active' : '';
    html += `<button class="cat-btn${active}" onclick="setCat('${c.id}')">
      <span>${c.name}</span>
      <span class="cat-count">${counts[c.id] || 0}</span>
    </button>`;
  });
  el.innerHTML = html;
}

function renderTags() {
  const tags = allUniqueTags();
  const el   = document.getElementById('tagCloud');
  el.innerHTML = tags.map(t => {
    const active = activeTags.includes(t) ? ' active' : '';
    return `<button class="tag-pill${active}" onclick="toggleTag('${t.replace(/'/g, "\\'")}')">
      ${t}
    </button>`;
  }).join('');
}

function renderCards() {
  const results = filteredResources();
  document.getElementById('resultBar').textContent =
    results.length === DATA.resources.length
      ? `Showing all ${results.length} resources`
      : `${results.length} resource${results.length !== 1 ? 's' : ''} match your filters`;

  const el = document.getElementById('cardList');
  if (!results.length) {
    el.innerHTML = '<div class="empty-state">No resources match your current filters.<br><small>Try broadening your search or clearing a filter.</small></div>';
    return;
  }
  el.innerHTML = results.map(r => `
    <div class="card">
      <div class="card-header">
        <div class="card-title-row">
          <span class="card-name"><a href="${r.official_url}" target="_blank" rel="noopener">${r.name}</a></span>
          <span class="badge">${r.tags[0]}</span>
        </div>
        <span class="badge-pricing">Updated ${r.last_updated}</span>
      </div>
      <p class="card-desc">${r.description}</p>

      <!-- Capabilities / Use Cases only render if the repo supplies them -->
      ${(r.key_capabilities.length || r.use_cases.length) ? `
      <div class="card-body">
        ${r.key_capabilities.length ? `<div>
          <div class="card-section-label">Capabilities</div>
          <div class="card-capabilities">${r.key_capabilities.map(c => `<span class="cap-pill">${c}</span>`).join('')}</div>
        </div>` : ''}
        ${r.use_cases.length ? `<div>
          <div class="card-section-label">Use Cases</div>
          <div class="card-capabilities">${r.use_cases.map(u => `<span class="cap-pill">${u}</span>`).join('')}</div>
        </div>` : ''}
      </div>` : ''}

      <!-- Type pills (all tokens) shown as tags row -->
      <div class="card-tags">${r.tags.map(t => `<span class="card-tag">${t}</span>`).join('')}</div>

      <!-- Links: only render anchors for URLs that actually exist -->
      <div class="card-links">
        <a class="card-link" href="${r.official_url}" target="_blank" rel="noopener">
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M6 8h4M8 6v4M3 13L13 3M3 3h10v10"/></svg>
          Website
        </a>
        ${r.documentation_url ? `<a class="card-link" href="${r.documentation_url}" target="_blank" rel="noopener">
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="2" y="1" width="12" height="14" rx="2"/><line x1="5" y1="5" x2="11" y2="5"/><line x1="5" y1="8" x2="11" y2="8"/><line x1="5" y1="11" x2="8" y2="11"/></svg>
          Docs
        </a>` : ''}
        ${r.github ? `<a class="card-link" href="${r.github}" target="_blank" rel="noopener">
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="8" cy="8" r="6"/><path d="M6 11c0-1 .5-2 2-2s2 1 2 2"/></svg>
          GitHub
        </a>` : ''}
      </div>
    </div>
  `).join('');
}

// ── ACTIONS ───────────────────────────────────────────────────────────────
function setCat(id) { activeCategory = id; render(); }
function toggleTag(t) {
  const i = activeTags.indexOf(t);
  i === -1 ? activeTags.push(t) : activeTags.splice(i, 1);
  render();
}
document.getElementById('searchInput').addEventListener('input', e => {
  searchQuery = e.target.value.trim();
  render();
});

// ── LOADING / ERROR STATES ────────────────────────────────────────────────
function showLoading() {
  document.getElementById('cardList').innerHTML =
    '<div class="empty-state" style="padding:80px 20px;">Loading resources…<br><small style="color:var(--text-low)">Fetching from GitHub</small></div>';
}
function showError(msg) {
  document.getElementById('cardList').innerHTML =
    `<div class="empty-state" style="padding:80px 20px;"><strong style="color:#c0392b;">Failed to load resources</strong><br><small>${msg}</small></div>`;
}

// ── INIT: fetch → map → render ────────────────────────────────────────────
// Try direct first; if that fails (CORS, network, etc.) retry via a public
// CORS proxy so it works regardless of where this HTML is hosted.
const CORS_PROXY = 'https://corsproxy.io/?';

function applyData(json) {
  DATA = mapRepoData(json);

  document.getElementById('heroTitle').textContent  = DATA.metadata.title;
  document.getElementById('heroDesc').textContent   = DATA.metadata.description;
  document.getElementById('heroStats').innerHTML    = `
    <div class="stat"><div class="stat-num">${DATA.metadata.totalResources}</div><div class="stat-label">Resources</div></div>
    <div class="stat"><div class="stat-num">${DATA.categories.length}</div><div class="stat-label">Categories</div></div>
    <div class="stat"><div class="stat-num">${allUniqueTags().length}</div><div class="stat-label">Tags</div></div>`;
  document.getElementById('lastUpdated').textContent =
    'Updated ' + new Date(DATA.metadata.lastUpdated).toLocaleDateString('en-US', { month:'short', day:'numeric', year:'numeric' });

  render();
}

async function loadData() {
  showLoading();

  // attempt 1 — direct
  try {
    const res = await fetch(JSON_URL);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const json = await res.json();
    applyData(json);
    return;                                                // ✓ done
  } catch (e) {
    console.warn('Direct fetch failed, trying CORS proxy…', e);
  }

  // attempt 2 — CORS proxy fallback
  try {
    const res = await fetch(CORS_PROXY + encodeURIComponent(JSON_URL));
    if (!res.ok) throw new Error(`HTTP ${res.status} (proxy)`);
    const json = await res.json();
    applyData(json);
    return;                                                // ✓ done
  } catch (e) {
    console.error('Proxy fetch also failed:', e);
    showError(`Both direct and proxy requests failed.<br>
      Open your browser console (F12 → Network) and check for CORS or 404 errors.`);
  }
}

loadData();
</script>
</body>
</html>
